{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Formulario por pasos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/styles_multistep.css' %}" />
    <style>
      .wizard-nav {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        padding: 0;
        list-style: none;
      }
      .wizard-nav li {
        flex: 1;
        text-align: center;
        padding: 10px;
        border-bottom: 4px solid lightgray;
        font-weight: bold;
        color: #6c757d;
      }
      .wizard-nav .active {
        border-color: #0d6efd;
        color: #0d6efd;
        background-color: #e9f2ff;
      }
    </style>
  </head>

  <body>
    <div class="container mt-5">
      <h2 class="text-center mb-4">Registro por pasos</h2>

      <ul class="wizard-nav">
        <li class="{% if paso == 0 %}active{% endif %}">1. Participante</li>
        <li class="{% if paso == 1 %}active{% endif %}">
          2. Datos Complementarios
        </li>
        <li class="{% if paso == 2 %}active{% endif %}">3. Acudiente</li>
        <li class="{% if paso == 3 %}active{% endif %}">4. Curso</li>
      </ul>

      {% with paso_actual=paso|add:1 %} {% if paso_actual == 1 %}
      <p class="text-center fw-bold">ðŸ§© Paso 1 de 4: Participante</p>
      {% elif paso_actual == 2 %}
      <p class="text-center fw-bold">ðŸ§© Paso 2 de 4: Datos Complementarios</p>
      {% elif paso_actual == 3 %}
      <p class="text-center fw-bold">ðŸ§© Paso 3 de 4: Acudiente</p>
      {% elif paso_actual == 4 %}
      <p class="text-center fw-bold">ðŸ§© Paso 4 de 4: Curso</p>
      {% endif %} {% endwith %} {% if messages %}
      <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %} {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
        {% endif %} {% for field in form.visible_fields %}
        <div class="mb-3">
          <label for="{{ field.id_for_label }}" class="form-label"
            >{{ field.label }}</label
          >

          {% if field.field.widget|slugify == "checkboxselectmultiple" %}
          <div class="form-check">
            {% for checkbox in field %}
            <div>
              <input
                type="checkbox"
                class="form-check-input"
                name="{{ checkbox.name }}"
                id="{{ checkbox.id_for_label }}"
                value="{{ checkbox.choice_value }}"
                {%
                if
                checkbox.choice_value
                in
                checkbox.data
                %}checked{%
                endif
                %}
              />
              <label class="form-check-label"
                >{{ checkbox.choice_label }}</label
              >
            </div>
            {% endfor %}
          </div>

          {% elif field.field.widget.input_type == "checkbox" %}
          <div class="form-check">
            <input
              type="checkbox"
              class="form-check-input"
              name="{{ field.name }}"
              id="{{ field.id_for_label }}"
              {%
              if
              field.value
              %}checked{%
              endif
              %}
            />
          </div>

          {% elif field.field.widget.input_type == "select" or
          field.field.widget|slugify == "selectmultiple" %}
          <select
            name="{{ field.name }}"
            id="{{ field.id_for_label }}"
            class="form-select"
            {%
            if
            field.field.widget.attrs.multiple
            %}multiple{%
            endif
            %}
          >
            {% for option in field.field.choices %}
            <option
              value="{{ option.0 }}"
              {%
              if
              field.value
              and
              option.0
              in
              field.value
              %}selected{%
              endif
              %}
              data-group="{{ option.0|lower }}"
            >
              {{ option.1 }}
            </option>
            {% endfor %}
          </select>

          {% else %}
          <input
            type="{{ field.field.widget.input_type }}"
            class="form-control"
            name="{{ field.name }}"
            id="{{ field.id_for_label }}"
            value="{{ field.value|default_if_none:'' }}"
          />
          {% endif %} {% if field.errors %}
          <div class="text-danger mt-1">{{ field.errors|join:", " }}</div>
          {% endif %}
        </div>
        {% endfor %}

        <div class="d-flex justify-content-between mt-4">
          {% if paso > 0 %}
          <a href="?paso={{ paso|add:'-1' }}" class="btn btn-secondary"
            >â¬… AtrÃ¡s</a
          >
          {% else %}
          <span></span>
          {% endif %}
          <button type="submit" class="btn btn-primary">
            {% if paso == 3 %} Finalizar {% else %} Siguiente âž¡ {% endif %}
          </button>
        </div>
      </form>
    </div>

    {% if paso == 3 %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const tipoCurso = document.getElementById("id_tipo_curso");
        const disciplinaSelect = document.getElementById("id_disciplina");

        const mapping = {
          Deporte: ["Microfutbol", "Futbol", "Basketball", "Voleibol"],
          Cultura: ["Danza", "Baile", "FotografÃ­a", "Pintura"],
        };

        function filtrarDisciplinas() {
          const tipo = tipoCurso.value;
          const permitidas = mapping[tipo] || [];

          Array.from(disciplinaSelect.options).forEach((option) => {
            option.style.display = permitidas.includes(option.value)
              ? "block"
              : "none";
          });

          if (!permitidas.includes(disciplinaSelect.value)) {
            disciplinaSelect.value = "";
          }
        }

        if (tipoCurso && disciplinaSelect) {
          tipoCurso.addEventListener("change", filtrarDisciplinas);
          filtrarDisciplinas();
        }
      });
    </script>
    {% endif %}
  </body>
</html>
